version: "3"
services:
    consent:
        image: mshare/consent
        build: ./services/consent
        volumes:
            - ./services/consent:/app
        entrypoint: CompileDaemon --build="go build -o /consent" --command=/consent
        ports:
            - 8180:8080
        depends_on:
            - "mongo"
        environment:
            MONGO_URL: "mongodb://mongo:27017"
            MONGO_USERNAME: root
            MONGO_PASSWORD: example
            MONGO_DB_NAME: consent
    healthcare-provider:
        image: mshare/healthcare-provider
        build: ./services/healthcare-provider
        volumes:
            - ./services/healthcare-provider:/app
        entrypoint: CompileDaemon --build="go build -o /healthcare-provider" --command=/healthcare-provider
        ports:
            - 8280:8080
        depends_on:
            - "mongo"
        environment:
            MONGO_URL: "mongodb://mongo:27017"
            MONGO_USERNAME: root
            MONGO_PASSWORD: example
            MONGO_DB_NAME: healthcare-provider
            JWT_SECRET: development
    medication-record:
        image: mshare/medication-record
        build: ./services/medication-record
        volumes:
            - ./services/medication-record:/app
        entrypoint: CompileDaemon --build="go build -o /medication-record" --command=/medication-record
        ports:
            - 8380:8080
        environment:
            FHIR_URL: fhir
    standardization:
        image: mshare/standardization
        build: ./services/standardization
        volumes:
            - ./services/standardization:/app
        entrypoint: CompileDaemon --build="go build -o /standardization" --command=/standardization
        ports:
            - 8480:8080
    mongo:
        image: mongo:4.4
        restart: always
        ports:
            - "27017:27017"
        environment:
            MONGO_INITDB_ROOT_USERNAME: root
            MONGO_INITDB_ROOT_PASSWORD: example

    react-frontend:
        image: mshare/react-frontend
        build: ./services/react-frontend
        volumes:
            - /app/node_modules
            - ./services/react-frontend:/app
        ports:
            - 3000:3000
        stdin_open: true
        environment:
            - CHOKIDAR_USEPOLLING=true
            - REACT_APP_PRODUCTION=false
        command: npm start
    fhir:
        image: "hapiproject/hapi:latest"
        ports:
            - "8085:8080"
