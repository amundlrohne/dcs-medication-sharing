name: "test"
on:
    pull_request:

jobs:
    test:
        name: "Postman Tests"
        timeout-minutes: 10
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Start containers
              run: docker-compose -f "docker-compose.yml" up -d --build

            - name: Test container
              run: curl http://127.0.0.11:8380/medication-record/0

            - name: Install Postman CLI
              run: |
                  curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh
            - name: Login to Postman CLI
              run: postman login --with-api-key ${{ secrets.POSTMAN_API_KEY }}
            - name: Run API tests
              run: |
                  postman collection run "12643913-f305514c-d9cf-4bc5-8187-08a37f93adc5"
